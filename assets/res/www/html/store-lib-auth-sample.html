<!DOCTYPE html>
<html lang="ko">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
<meta name="format-detection" content="telephone=no, address=no, email=no">
<title>협력직원 앱스토어 라이브러리 인증 연동 페이지</title>
<link rel="stylesheet" type="text/css" href="../../css/style.css">
<link rel="stylesheet" type="text/css" href="../../css/morpheus-style.css">	
<head>
</head>
<body>
<h3>협력직원 앱스토어 라이브러리 인증 연동 페이지</h3>

<button id="btnBack">뒤로가기</button><br><br>
<h5>1. 앱스토어 라이브러리 인증 연동</h5>
<button id="btnAuth" onclick="storeLibAuth()">인증 연동</button><br><br>

</body>

<script type="text/javascript" src="../js/mcore.min.js"></script>
<script type="text/javascript">

document.querySelector('#btnBack').onclick=function(){
    M.page.back();
}

var memberYN = "N"; // 정직원 여부(Y: 정직원, 그외:협력직원)

/**
 * 인증 체크 callback
 * resultJsonObj
 * {"code":"1000", "msg":"정상 인증"}
 * code
 * 1000 : 정상 인증
 * 2000 : 인증 오류
 * 3000 : ID 또는 비밀번호 오류
 * 4000 : Major 업데이트된 App이 스토어에 배포된 상태
 * 5000 : token 만료
 * 6000 : token 값이 일치하지 않음
 * 7000 : 버전 확인 오류
 * 8000 : 로그아웃
 * 9000 : 기타 오류
 * 9001 : 스토어가 설치되어 있지 않음
 * 9002 : MDM 오류
 * 9003 : 네이트워크 오류
 */
function exWNAuthCallback(resultJsonObj) {
	console.log("exWNAuthCallback(resultJsonObj)");

	console.log('type of resultJsonObj = ' + typeof resultJsonObj);
	console.log(JSON.stringify(resultJsonObj));

	var code = resultJsonObj.code;
    var msg = resultJsonObj.msg;
    M.pop.alert({
        title: '알림',
        message: "code = " + code + "\n" + "msg = " + msg,
        buttons: ['확인'],
        callback: function(index) {
        switch (code) {
            case '1000': // LibHelper.Result.CODE_SUCCESS:
                // 성공 - 비지니스 로직 수행.
                // 샘플에서는 사용자 정보를 출력해본다.
                storeGetUserInfo();
                break;
            case '9001': // LibHelper.Result.CODE_ERROR_STORE_NOT_INSTALLED:
                // 안내팝업후 앱종료하고 앱스토어 설치 페이지 이동.
                storeLibGoInstallPage();
                M.sys.exit();
                break;
            case '4000': // LibHelper.Result.CODE_ERROR_UPDATE:
                // Major 업데이트된 App이 앱스토어에 배포된 상태, 앱종료하고 앱 업데이트를 위해 앱스토어 호출
                storeLibUpdate();
                M.sys.exit();
                break;
            case '2000': // LibHelper.Result.CODE_ERROR_AUTH:
            case '3000': // LibHelper.Result.CODE_ERROR_ID_OR_PASSWORD:
            case '5000': // LibHelper.Result.CODE_ERROR_EXPIRE_TOKEN:
            case '6000': // LibHelper.Result.CODE_ERROR_TOKEN_NOT_MATCH:
            case '7000': // LibHelper.Result.CODE_ERROR_VERSION:
            case '8000': // LibHelper.Result.CODE_ERROR_LOGOUT:
            case '9002': // LibHelper.Result.CODE_ERROR_MDM:
                // 오류 팝업 안내후(잠시후 다시 시도 등) 앱종료하고 로그인을 위해 앱스토어 호출.
                storeLibLogin();
                M.sys.exit();
                break;
            case '9000': // LibHelper.Result.CODE_ERROR_SERVER:
            case '9003': // LibHelper.Result.CODE_ERROR_NET:
                // 오류 팝업 안내후(잠시후 다시 시도 등) 앱종료.
                M.sys.exit();
                break;
            }
        }
    });
}

// 앱스토어 로그인 사용자 정보 콜백
function exWNGetUserInfoCallback(resultJsonObj) {
	console.log("exWNGetUserInfoCallback(resultJsonObj)");

	console.log('type of resultJsonObj = ' + typeof resultJsonObj);
	console.log(JSON.stringify(resultJsonObj));
	alert(JSON.stringify(resultJsonObj));
}

function storeLibAuth() {
	console.log('function storeLibAuth()');
	M.execute("exWNStoreLib_auth", memberYN, "exWNAuthCallback");
};

function storeLibGoInstallPage() {
	console.log('function storeLibGoInstallPage()');
	M.execute("exWNStoreLib_goAppStoreInstallPage", memberYN);
};

function storeLibLogin() {
	console.log('function storeLibLogin()');
	M.execute("exWNStoreLib_login", memberYN, "schemeLogin");
};

function storeLibUpdate() {
	console.log('function storeLibUpdate()');
	M.execute("exWNStoreLib_update", memberYN, "schemeUpdate");
};

function storeGetUserInfo() {
	console.log('function storeGetUserInfo()');
	M.execute("exWNStoreLib_getUserInfo", memberYN, "exWNGetUserInfoCallback");
};

M.onReady(function(e) {

});

M.onHide(function(e){

});

M.onRestore(function(e) {

});

M.onBack( function(e) {
    M.page.back();
});

var MStatus = {
        onReady : function(){},
//        onBack : function(){},
        onRestore : function(){},
        onHide : function(){},
        onDestroy : function(){},
        onPause : function(){},
        onResume : function(){}
}
</script>
</html>
